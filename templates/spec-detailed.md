# 脚本规范：[脚本名称]

> 详尽版规范模板 - 适用于企业级项目（>500行，复杂逻辑）

## 1. 基本信息

- **脚本名称**：`[script-name].sh`
- **脚本路径**：`projects/[project-name]/[script-name].sh`
- **严格性级别**：基础级 / 标准级 / 企业级
- **脚本类型**：可执行脚本 / 库文件 / 工具脚本
- **作者**：[作者名称]
- **维护者**：[维护者名称]
- **创建日期**：YYYY-MM-DD
- **最后更新**：YYYY-MM-DD
- **版本**：v1.0.0
- **许可证**：[Apache 2.0 / MIT / GPL]

## 2. 功能概述

### 2.1 核心功能

[详细描述脚本的主要功能，包括：]

1. **功能模块 1**：[模块名称]
   - 子功能 1.1：[描述]
   - 子功能 1.2：[描述]
   - 子功能 1.3：[描述]

2. **功能模块 2**：[模块名称]
   - 子功能 2.1：[描述]
   - 子功能 2.2：[描述]

3. **功能模块 3**：[模块名称]
   - 子功能 3.1：[描述]

### 2.2 使用场景

- **场景 1**：[场景名称]
  - 适用条件：[...]
  - 输入数据：[...]
  - 预期结果：[...]
  - 示例：[...]

- **场景 2**：[场景名称]
  - 适用条件：[...]
  - 输入数据：[...]
  - 预期结果：[...]
  - 示例：[...]

### 2.3 设计目标

- **性能目标**：
  - 处理速度：[如 1000 个文件/秒]
  - 内存占用：[如 < 500MB]
  - 响应时间：[如 < 100ms]

- **可维护性**：
  - 代码结构清晰，模块化设计
  - 完整的文档和注释
  - 遵循项目编码规范

- **可扩展性**：
  - 支持插件机制
  - 配置灵活可调
  - 易于添加新功能

- **可靠性**：
  - 完善的错误处理
  - 数据一致性保证
  - 支持断点续传

## 3. 技术架构

### 3.1 模块划分

```
script-name.sh
├── 初始化模块
│   ├── 环境检查
│   ├── 参数解析
│   └── 配置加载
├── 核心处理模块
│   ├── 数据读取
│   ├── 数据处理
│   └── 数据输出
├── 工具函数模块
│   ├── 日志函数
│   ├── 验证函数
│   └── 辅助函数
└── 清理模块
    ├── 临时文件清理
    └── 资源释放
```

### 3.2 数据流

```
输入数据 → 参数验证 → 数据读取 → 数据处理 → 数据输出 → 清理
    ↓           ↓           ↓           ↓           ↓         ↓
  日志       日志        日志        日志        日志      日志
```

### 3.3 状态管理

- **状态文件**：[是否使用状态文件]
- **状态保存**：[如何保存状态]
- **状态恢复**：[如何恢复状态]
- **并发控制**：[如何处理并发]

## 4. 使用方法

### 4.1 基本语法

```bash
script-name.sh [全局选项] <命令> [命令选项] <参数>
```

### 4.2 全局选项

- `-v, --verbose`：启用详细输出
- `-d, --debug`：启用调试模式
- `-q, --quiet`：静默模式（仅输出错误）
- `-c, --config <file>`：指定配置文件
- `-h, --help`：显示帮助信息
- `--version`：显示版本信息

### 4.3 命令列表

#### 命令 1：[命令名称]

**用途**：[描述]

**语法**：
```bash
script-name.sh [全局选项] command1 [选项] <参数>
```

**选项**：
- `-o, --output <path>`：输出路径
- `-f, --force`：强制执行
- `[其他选项]`

**参数**：
- `<input>`：输入文件或目录
- `[其他参数]`

**示例**：
```bash
script-name.sh command1 -o output.txt input.txt
```

#### 命令 2：[命令名称]

[类似结构...]

### 4.4 环境变量

| 变量名 | 描述 | 默认值 | 示例 |
|--------|------|--------|------|
| `DEBUG` | 调试模式 | 0 | `DEBUG=1` |
| `VERBOSE` | 详细输出 | 0 | `VERBOSE=1` |
| `CONFIG_FILE` | 配置文件路径 | `./config.conf` | `CONFIG_FILE=/etc/app/config.conf` |
| `LOG_LEVEL` | 日志级别 | INFO | `LOG_LEVEL=DEBUG` |
| `MAX_RETRIES` | 最大重试次数 | 3 | `MAX_RETRIES=5` |

### 4.5 配置文件

**配置文件格式**：[INI / JSON / YAML / Shell 变量]

**配置文件示例**：
```ini
[general]
log_level = INFO
max_retries = 3

[network]
timeout = 30
proxy = http://proxy.example.com:8080

[processing]
batch_size = 100
parallel_jobs = 4
```

**配置项说明**：

| 配置项 | 类型 | 必需 | 默认值 | 描述 |
|--------|------|------|--------|------|
| `log_level` | string | 否 | INFO | 日志级别 |
| `max_retries` | int | 否 | 3 | 最大重试次数 |
| `timeout` | int | 否 | 30 | 超时时间（秒） |

### 4.6 使用示例

```bash
# 示例 1：基本用法
script-name.sh command1 input.txt

# 示例 2：使用配置文件
script-name.sh -c /etc/app/config.conf command1 input.txt

# 示例 3：详细模式
script-name.sh -v command1 input.txt

# 示例 4：调试模式
DEBUG=1 script-name.sh command1 input.txt

# 示例 5：批量处理
for file in data/*.txt; do
    script-name.sh command1 "$file"
done

# 示例 6：管道使用
cat input.txt | script-name.sh command2 | tee output.txt
```

## 5. 依赖关系

### 5.1 系统要求

- **操作系统**：
  - Linux (Ubuntu 20.04+, CentOS 7+, Debian 10+)
  - macOS (10.15+)
  - 不支持：Windows

- **Bash 版本**：4.0+
  - 检查方法：`bash --version`

- **权限要求**：
  - 普通用户：[可以 / 不可以]
  - root 权限：[需要 / 不需要]
  - 特定用户组：[如 docker 组]

### 5.2 必需工具

| 工具 | 最低版本 | 用途 | 检查命令 |
|------|---------|------|----------|
| `git` | 2.0+ | 版本控制 | `git --version` |
| `docker` | 20.0+ | 容器运行 | `docker --version` |
| `jq` | 1.6+ | JSON 处理 | `jq --version` |
| `curl` | 7.0+ | HTTP 请求 | `curl --version` |

### 5.3 可选工具

| 工具 | 用途 | 说明 |
|------|------|------|
| `shellcheck` | 静态分析 | 用于代码质量检查 |
| `shfmt` | 代码格式化 | 用于代码格式化 |

### 5.4 库依赖

- **内部库**：
  - `lib/common.sh`：通用工具函数
  - `lib/logging.sh`：日志系统
  - `lib/validation.sh`：数据验证

- **外部库**：
  - [列出外部依赖]

### 5.5 外部服务依赖

- **API 服务**：
  - 服务名称：[...]
  - 服务地址：[...]
  - 认证方式：[...]
  - API 版本：[...]

- **数据库**：
  - 数据库类型：[MySQL / PostgreSQL / MongoDB]
  - 连接信息：[...]
  - 权限要求：[...]

## 6. 安全性考虑

### 6.1 权限管理

- **文件权限**：
  - 脚本文件：755 (rwxr-xr-x)
  - 配置文件：600 (rw-------)
  - 日志文件：644 (rw-r--r--)

- **用户权限**：
  - 最小权限原则
  - 避免使用 root 权限
  - 使用专用服务账号

### 6.2 输入验证

- **参数验证**：
  - 检查参数类型和格式
  - 验证文件路径的合法性
  - 防止路径遍历攻击

- **数据验证**：
  - 验证输入数据格式
  - 检查数据完整性
  - 防止注入攻击

### 6.3 敏感数据处理

- **密码和密钥**：
  - 不在代码中硬编码
  - 使用环境变量或密钥管理系统
  - 不记录到日志文件

- **日志脱敏**：
  - 敏感信息脱敏处理
  - 避免记录完整的密码、密钥
  - 使用 `***` 替换敏感部分

## 7. 跨平台兼容性

### 7.1 支持平台

| 平台 | 支持状态 | 测试版本 | 注意事项 |
|------|---------|---------|----------|
| Linux | ✅ 完全支持 | Ubuntu 20.04, CentOS 7 | - |
| macOS | ✅ 完全支持 | macOS 11+ | 需要 Homebrew 安装依赖 |
| Windows | ❌ 不支持 | - | 可使用 WSL |

### 7.2 平台差异

- **命令差异**：
  - `sed`：Linux 使用 GNU sed，macOS 使用 BSD sed
  - `date`：日期格式参数不同
  - `readlink`：macOS 不支持 `-f` 参数

- **处理方式**：
  ```bash
  # 检测平台并使用不同命令
  if [[ "$(uname -s)" == "Darwin" ]]; then
      # macOS 特定处理
      SED="gsed"
  else
      # Linux 处理
      SED="sed"
  fi
  ```

### 7.3 兼容性测试

- [ ] 在 Ubuntu 20.04 上测试
- [ ] 在 CentOS 7 上测试
- [ ] 在 macOS 11+ 上测试
- [ ] 测试不同 Bash 版本（4.0, 4.4, 5.0）

## 8. 边界条件处理

### 8.1 空输入处理

- **空文件**：[如何处理]
- **空目录**：[如何处理]
- **空字符串**：[如何处理]

### 8.2 大文件处理

- **文件大小限制**：[如 < 10GB]
- **内存优化**：[如流式处理]
- **进度显示**：[是否显示进度]

### 8.3 特殊字符处理

- **文件名包含空格**：正确处理
- **文件名包含特殊字符**：正确转义
- **Unicode 字符**：正确处理

### 8.4 并发处理

- **多实例运行**：[是否支持]
- **锁机制**：[如何实现]
- **资源竞争**：[如何避免]

## 9. 完整测试用例

### 9.1 正常流程测试

| 测试用例 | 输入 | 预期输出 | 实际结果 | 状态 |
|---------|------|---------|---------|------|
| TC-001 | 有效文件 | 处理成功 | - | [ ] |
| TC-002 | 多个文件 | 批量处理成功 | - | [ ] |
| TC-003 | 大文件 | 流式处理成功 | - | [ ] |

### 9.2 异常流程测试

| 测试用例 | 输入 | 预期输出 | 实际结果 | 状态 |
|---------|------|---------|---------|------|
| TC-101 | 文件不存在 | 错误消息，退出码 4 | - | [ ] |
| TC-102 | 权限不足 | 错误消息，退出码 5 | - | [ ] |
| TC-103 | 无效参数 | 错误消息，退出码 2 | - | [ ] |

### 9.3 边界条件测试

| 测试用例 | 输入 | 预期输出 | 实际结果 | 状态 |
|---------|------|---------|---------|------|
| TC-201 | 空文件 | 正常处理或跳过 | - | [ ] |
| TC-202 | 超大文件 | 流式处理 | - | [ ] |
| TC-203 | 特殊字符文件名 | 正确处理 | - | [ ] |

### 9.4 性能测试

| 测试用例 | 输入规模 | 预期时间 | 实际时间 | 状态 |
|---------|---------|---------|---------|------|
| TC-301 | 1000 个文件 | < 10 秒 | - | [ ] |
| TC-302 | 10000 个文件 | < 100 秒 | - | [ ] |

### 9.5 安全测试

| 测试用例 | 攻击方式 | 预期结果 | 实际结果 | 状态 |
|---------|---------|---------|---------|------|
| TC-401 | 路径遍历 | 拒绝访问 | - | [ ] |
| TC-402 | 命令注入 | 参数验证失败 | - | [ ] |

## 10. 维护和扩展

### 10.1 代码组织

- **模块化设计**：每个功能模块独立
- **函数复用**：提取通用函数
- **配置分离**：配置与代码分离

### 10.2 扩展点

- **插件机制**：[是否支持插件]
- **钩子函数**：[预留的钩子点]
- **配置扩展**：[可扩展的配置项]

### 10.3 版本管理

- **版本号规则**：语义化版本（SemVer）
- **变更日志**：记录每个版本的变更
- **向后兼容**：[兼容性策略]

### 10.4 文档维护

- **代码注释**：保持注释与代码同步
- **规范文档**：及时更新本文档
- **使用示例**：提供最新的使用示例

## 11. 已知限制

### 11.1 功能限制

- [限制 1]：[描述]
- [限制 2]：[描述]

### 11.2 性能限制

- [限制 1]：[描述]
- [限制 2]：[描述]

### 11.3 兼容性限制

- [限制 1]：[描述]
- [限制 2]：[描述]

## 12. 常见问题

### Q1: [问题]

**A**: [答案]

### Q2: [问题]

**A**: [答案]

## 13. 变更历史

| 版本 | 日期 | 变更内容 | 作者 |
|------|------|---------|------|
| v1.0.0 | YYYY-MM-DD | 初始版本 | [作者] |
| v1.1.0 | YYYY-MM-DD | 添加功能 X | [作者] |

---

**填写说明**：
1. 将所有 `[占位符]` 替换为实际内容
2. 删除不需要的章节或字段
3. 根据实际情况调整参数和示例
4. 确保所有信息准确、完整
5. 所有测试用例必须完成并打勾
6. 定期更新文档以保持与代码同步

