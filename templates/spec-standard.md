# 脚本规范：[脚本名称]

> 标准版规范模板 - 适用于生产环境脚本（100-500行，多功能）

## 1. 基本信息

- **脚本名称**：`[script-name].sh`
- **脚本路径**：`projects/[project-name]/[script-name].sh`
- **严格性级别**：基础级 / 标准级 / 企业级
- **脚本类型**：可执行脚本 / 库文件 / 工具脚本
- **作者**：[作者名称]
- **创建日期**：YYYY-MM-DD
- **最后更新**：YYYY-MM-DD
- **版本**：v1.0.0

## 2. 功能概述

### 2.1 核心功能

[详细描述脚本的主要功能，包括：]

1. **功能点 1**：[描述]
   - 子功能 1.1
   - 子功能 1.2

2. **功能点 2**：[描述]
   - 子功能 2.1
   - 子功能 2.2

3. **功能点 3**：[描述]

### 2.2 使用场景

- **场景 1**：[描述具体的使用场景]
  - 适用条件：[...]
  - 预期结果：[...]

- **场景 2**：[描述具体的使用场景]
  - 适用条件：[...]
  - 预期结果：[...]

### 2.3 设计目标

- **性能目标**：[如处理速度、内存占用等]
- **可维护性**：[如代码结构、文档完整性等]
- **可扩展性**：[如支持插件、配置灵活等]
- **可靠性**：[如错误处理、数据一致性等]

## 3. 使用方法

### 3.1 基本语法

```bash
script-name.sh [选项] <必需参数> [可选参数]
```

### 3.2 参数说明

#### 必需参数

- `<input>`：输入文件或目录路径
  - 类型：文件路径 / 目录路径
  - 约束：必须存在且可读
  - 示例：`/path/to/input.txt`

- `<target>`：目标位置
  - 类型：字符串
  - 约束：[具体约束]
  - 示例：`production`

#### 可选参数

- `-o, --output <path>`：输出路径
  - 默认值：stdout
  - 类型：文件路径
  - 示例：`-o /path/to/output.txt`

- `-c, --config <file>`：配置文件路径
  - 默认值：`./config.conf`
  - 类型：文件路径
  - 示例：`-c /etc/myapp/config.conf`

- `-v, --verbose`：启用详细输出
  - 默认值：关闭
  - 说明：显示详细的处理过程

- `-d, --debug`：启用调试模式
  - 默认值：关闭
  - 说明：显示调试信息和执行跟踪

- `-n, --dry-run`：模拟运行（不实际执行）
  - 默认值：关闭
  - 说明：仅显示将要执行的操作

- `-h, --help`：显示帮助信息
  - 说明：显示完整的使用说明并退出

### 3.3 环境变量

- `DEBUG`：设置为 1 启用调试日志
  - 默认值：0
  - 示例：`DEBUG=1 script-name.sh`

- `VERBOSE`：设置为 1 启用详细输出
  - 默认值：0
  - 示例：`VERBOSE=1 script-name.sh`

- `CONFIG_FILE`：配置文件路径
  - 默认值：`./config.conf`
  - 示例：`CONFIG_FILE=/etc/myapp/config.conf script-name.sh`

- `[其他环境变量]`：[描述]

### 3.4 使用示例

```bash
# 示例 1：基本用法
script-name.sh input.txt production

# 示例 2：指定输出文件
script-name.sh -o output.txt input.txt production

# 示例 3：使用配置文件
script-name.sh -c /etc/myapp/config.conf input.txt production

# 示例 4：详细模式
VERBOSE=1 script-name.sh input.txt production

# 示例 5：调试模式
DEBUG=1 script-name.sh input.txt production

# 示例 6：模拟运行
script-name.sh --dry-run input.txt production

# 示例 7：组合多个选项
script-name.sh -v -o output.txt -c config.conf input.txt production
```

## 4. 依赖关系

### 4.1 系统要求

- **操作系统**：Linux, macOS
- **Bash 版本**：4.0+
- **权限要求**：普通用户 / root / 特定用户组

### 4.2 必需工具

- `git`：版本控制（版本 2.0+）
- `docker`：容器运行（版本 20.0+）
- `jq`：JSON 处理（版本 1.6+）
- `curl`：HTTP 请求（版本 7.0+）
- `[其他工具]`：[描述和版本要求]

### 4.3 库依赖

- `reference/lib/common.sh`：通用工具函数
  - 使用方式：复制需要的函数到脚本中
  - 依赖函数：`log_info`, `log_error`, `detect_os`

- `[其他库文件]`：[描述]

### 4.4 外部服务依赖

- **API 服务**：[服务名称和地址]
- **数据库**：[数据库类型和连接信息]
- **其他服务**：[描述]

## 5. 输入输出

### 5.1 输入

#### 文件输入

- **输入文件格式**：[文本 / JSON / YAML / 二进制]
- **文件编码**：UTF-8
- **文件大小限制**：[如 < 100MB]
- **示例内容**：
  ```
  [示例文件内容]
  ```

#### 标准输入

- **是否支持**：是 / 否
- **输入格式**：[描述]
- **使用方式**：`cat input.txt | script-name.sh`

#### 配置文件

- **配置文件路径**：`./config.conf` 或通过 `-c` 指定
- **配置格式**：[INI / JSON / YAML / Shell 变量]
- **必需配置项**：
  ```
  [示例配置]
  ```

### 5.2 输出

#### 标准输出

- **输出格式**：[文本 / JSON / YAML / 表格]
- **输出内容**：
  - 处理进度信息
  - 处理结果摘要
  - 统计数据
- **示例输出**：
  ```
  [INFO] 开始处理...
  [INFO] 处理完成: 100 个文件
  ```

#### 标准错误

- **错误消息格式**：`[ERROR] 错误描述`
- **警告消息格式**：`[WARN] 警告描述`
- **调试消息格式**：`[DEBUG] 调试信息`

#### 文件输出

- **输出文件路径**：通过 `-o` 参数指定或默认路径
- **输出文件格式**：[文本 / JSON / YAML / 二进制]
- **文件编码**：UTF-8

#### 日志输出

- **日志级别**：INFO, WARN, ERROR, DEBUG
- **日志位置**：stdout / stderr / 日志文件
- **日志格式**：`[级别] 消息内容`

### 5.3 退出码

- `0`：成功
- `1`：一般错误
- `2`：参数错误（缺失或无效）
- `3`：依赖工具缺失
- `4`：文件不存在或无法访问
- `5`：权限不足
- `6`：网络错误
- `7`：外部服务错误
- `[其他退出码]`：[描述]

## 6. 错误处理

### 6.1 错误场景

1. **参数错误**
   - 场景：缺失必需参数、参数格式错误
   - 处理：显示错误消息和帮助信息，退出码 2

2. **文件错误**
   - 场景：文件不存在、无法读取、无法写入
   - 处理：显示错误消息，退出码 4

3. **权限错误**
   - 场景：权限不足
   - 处理：显示错误消息，退出码 5

4. **依赖工具缺失**
   - 场景：必需工具未安装
   - 处理：显示缺失工具列表，退出码 3

5. **网络错误**
   - 场景：网络连接失败、超时
   - 处理：重试 3 次，失败后退出，退出码 6

6. **[其他错误场景]**
   - 场景：[描述]
   - 处理：[描述]

### 6.2 错误消息格式

```bash
[ERROR] 错误类型: 详细描述
[ERROR] 建议操作: 如何解决
```

示例：
```
[ERROR] 文件不存在: /path/to/input.txt
[ERROR] 建议操作: 请检查文件路径是否正确
```

### 6.3 错误恢复

- **自动重试**：网络请求失败时自动重试 3 次
- **清理操作**：脚本退出时自动清理临时文件
- **状态保存**：[是否支持断点续传]

## 7. 性能要求

### 7.1 时间复杂度

- **预期执行时间**：[如 < 10 秒处理 1000 个文件]
- **最大执行时间**：[如 < 5 分钟]

### 7.2 内存占用

- **预期内存占用**：[如 < 100MB]
- **最大内存占用**：[如 < 500MB]

### 7.3 并发处理

- **是否支持并发**：是 / 否
- **并发方式**：[多进程 / 后台任务]
- **最大并发数**：[如 4 个并发任务]

## 8. 测试要求

### 8.1 功能测试

- [ ] 正常流程测试：使用有效参数运行脚本
- [ ] 所有功能点测试：逐一测试每个功能
- [ ] 参数组合测试：测试不同参数组合
- [ ] 环境变量测试：测试 DEBUG、VERBOSE 等

### 8.2 边界条件测试

- [ ] 空输入测试：测试空文件、空目录
- [ ] 大文件测试：测试大文件处理
- [ ] 特殊字符测试：测试文件名包含空格、特殊字符
- [ ] 并发测试：测试多个实例同时运行

### 8.3 错误场景测试

- [ ] 参数错误测试：缺失参数、无效参数
- [ ] 文件错误测试：文件不存在、权限不足
- [ ] 依赖工具缺失测试：模拟工具不存在
- [ ] 网络错误测试：模拟网络故障
- [ ] 磁盘空间不足测试：模拟磁盘满

## 9. 文档要求

### 9.1 帮助信息

脚本必须提供 `-h/--help` 选项，显示：
- 脚本用途简介
- 使用语法
- 参数说明
- 使用示例
- 版本信息

### 9.2 使用示例

在 README.md 中提供：
- 基本用法示例
- 常见场景示例
- 高级用法示例

### 9.3 注意事项

- [重要提示 1]
- [重要提示 2]
- [已知限制]
- [常见问题]

---

**填写说明**：
1. 将所有 `[占位符]` 替换为实际内容
2. 删除不需要的章节或字段
3. 根据实际情况调整参数和示例
4. 确保所有信息准确、完整
5. 测试要求必须全部完成并打勾

